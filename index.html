<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pang9 finances</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üí∞ ‡πÅ‡∏≠‡∏û‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
            <p class="text-gray-600">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</p>
            
            <!-- Connection Status -->
            <div id="connectionStatus" class="mt-4 p-3 rounded-lg text-sm bg-blue-50 border border-blue-200">
                <div class="flex items-center gap-2">
                    <div id="statusIcon" class="w-3 h-3 rounded-full bg-blue-500"></div>
                    <span id="statusText">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets...</span>
                </div>
            </div>

        </div>

        <!-- Quick Setup -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                ‚ö° ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡πà‡∏ß‡∏ô - ‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏Ñ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πá‡∏û‡∏≠!
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="quickSalary" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="30000" oninput="autoCalculate()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="number" id="quickExtra" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="0" oninput="autoCalculate()">
                </div>
            </div>
            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <p class="text-blue-700 text-sm">üí° ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</p>
            </div>
        </div>

        <!-- Income & Expense Tracker -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex justify-center mb-4">
                <div class="bg-gray-100 p-1 rounded-lg">
                    <button id="expenseTab" onclick="switchTab('expense')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm transition duration-200">
                        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                    </button>
                    <button id="incomeTab" onclick="switchTab('income')" class="px-4 py-2 text-gray-600 rounded-lg text-sm transition duration-200 hover:bg-gray-200">
                        üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°
                    </button>
                </div>
            </div>
            
            <!-- Expense Tab -->
            <div id="expenseTabContent" class="tab-content">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Add Expense Form -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <div class="flex gap-2 mb-2">
                                    <button type="button" onclick="setAmount(20)" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition duration-200">20</button>
                                    <button type="button" onclick="setAmount(50)" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition duration-200">50</button>
                                    <button type="button" onclick="setAmount(100)" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition duration-200">100</button>
                                    <button type="button" onclick="setAmount(200)" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition duration-200">200</button>
                                    <button type="button" onclick="setAmount(500)" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition duration-200">500</button>
                                </div>
                                <input type="number" id="expenseAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏á">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <div class="grid grid-cols-2 gap-2" id="categoryButtons">
                                    <button type="button" onclick="selectCategory('food')" class="category-btn p-2 border-2 border-blue-500 bg-blue-50 text-blue-800 rounded-lg text-sm transition duration-200" data-category="food">
                                        üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£
                                    </button>
                                    <button type="button" onclick="selectCategory('transport')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="transport">
                                        üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                                    </button>
                                    <button type="button" onclick="selectCategory('housing')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="housing">
                                        üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å
                                    </button>
                                    <button type="button" onclick="selectCategory('entertainment')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="entertainment">
                                        üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á
                                    </button>
                                    <button type="button" onclick="selectCategory('bills')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="bills">
                                        üìÑ ‡∏ö‡∏¥‡∏•/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                                    </button>
                                    <button type="button" onclick="selectCategory('shopping')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="shopping">
                                        üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á
                                    </button>
                                    <button type="button" onclick="selectCategory('savings')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="savings">
                                        üí∞ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô
                                    </button>
                                    <button type="button" onclick="selectCategory('others')" class="category-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-blue-500 transition duration-200" data-category="others">
                                        üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                    </button>
                                </div>
                                <input type="hidden" id="selectedCategory" value="food">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                                <input type="text" id="expenseNote" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î, ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏£‡∏ñ">
                            </div>
                            <button onclick="addExpense()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                            </button>
                        </div>
                    </div>

                    <!-- Quick Add Buttons -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô</h3>
                        <div class="grid grid-cols-2 gap-2 mb-4" id="quickButtonsContainer">
                            <!-- Quick buttons will be rendered here -->
                        </div>
                        
                        <!-- Quick Buttons Management -->
                        <div class="mb-4">
                            <button onclick="toggleQuickButtonsEditor()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-200 text-sm">
                                ‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô
                            </button>
                            <div id="quickButtonsEditor" class="hidden mt-3 p-4 bg-gray-50 rounded-lg">
                                <h4 class="font-medium text-gray-800 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô</h4>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="space-y-3">
                                        <div class="flex gap-2">
                                            <input type="text" id="newButtonName" class="flex-1 px-3 py-2 border border-gray-300 rounded text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡πÅ‡∏ü">
                                            <input type="number" id="newButtonAmount" class="w-20 px-3 py-2 border border-gray-300 rounded text-sm" placeholder="50">
                                            <select id="newButtonCategory" class="px-3 py-2 border border-gray-300 rounded text-sm">
                                                <option value="food">üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                                <option value="transport">üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                                <option value="housing">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</option>
                                                <option value="entertainment">üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                                                <option value="bills">üìÑ ‡∏ö‡∏¥‡∏•/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</option>
                                                <option value="shopping">üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                                                <option value="savings">üí∞ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</option>
                                                <option value="others">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                            </select>
                                            <button onclick="addCustomQuickButton()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°):</label>
                                            <div class="grid grid-cols-10 gap-1 p-2 bg-gray-50 rounded-lg">
                                                <button type="button" onclick="addEmojiToButtonName('‚òï')" class="p-1 hover:bg-gray-200 rounded text-sm">‚òï</button>
                                                <button type="button" onclick="addEmojiToButtonName('üçî')" class="p-1 hover:bg-gray-200 rounded text-sm">üçî</button>
                                                <button type="button" onclick="addEmojiToButtonName('üçï')" class="p-1 hover:bg-gray-200 rounded text-sm">üçï</button>
                                                <button type="button" onclick="addEmojiToButtonName('üçú')" class="p-1 hover:bg-gray-200 rounded text-sm">üçú</button>
                                                <button type="button" onclick="addEmojiToButtonName('üöå')" class="p-1 hover:bg-gray-200 rounded text-sm">üöå</button>
                                                <button type="button" onclick="addEmojiToButtonName('üöï')" class="p-1 hover:bg-gray-200 rounded text-sm">üöï</button>
                                                <button type="button" onclick="addEmojiToButtonName('‚õΩ')" class="p-1 hover:bg-gray-200 rounded text-sm">‚õΩ</button>
                                                <button type="button" onclick="addEmojiToButtonName('üé¨')" class="p-1 hover:bg-gray-200 rounded text-sm">üé¨</button>
                                                <button type="button" onclick="addEmojiToButtonName('üéÆ')" class="p-1 hover:bg-gray-200 rounded text-sm">üéÆ</button>
                                                <button type="button" onclick="addEmojiToButtonName('üéµ')" class="p-1 hover:bg-gray-200 rounded text-sm">üéµ</button>
                                                <button type="button" onclick="addEmojiToButtonName('üí°')" class="p-1 hover:bg-gray-200 rounded text-sm">üí°</button>
                                                <button type="button" onclick="addEmojiToButtonName('üíß')" class="p-1 hover:bg-gray-200 rounded text-sm">üíß</button>
                                                <button type="button" onclick="addEmojiToButtonName('üì±')" class="p-1 hover:bg-gray-200 rounded text-sm">üì±</button>
                                                <button type="button" onclick="addEmojiToButtonName('üè•')" class="p-1 hover:bg-gray-200 rounded text-sm">üè•</button>
                                                <button type="button" onclick="addEmojiToButtonName('üëï')" class="p-1 hover:bg-gray-200 rounded text-sm">üëï</button>
                                                <button type="button" onclick="addEmojiToButtonName('üëü')" class="p-1 hover:bg-gray-200 rounded text-sm">üëü</button>
                                                <button type="button" onclick="addEmojiToButtonName('üíÑ')" class="p-1 hover:bg-gray-200 rounded text-sm">üíÑ</button>
                                                <button type="button" onclick="addEmojiToButtonName('üìö')" class="p-1 hover:bg-gray-200 rounded text-sm">üìö</button>
                                                <button type="button" onclick="addEmojiToButtonName('üí∞')" class="p-1 hover:bg-gray-200 rounded text-sm">üí∞</button>
                                                <button type="button" onclick="addEmojiToButtonName('üéÅ')" class="p-1 hover:bg-gray-200 rounded text-sm">üéÅ</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 mt-2">
                                        <button onclick="resetToDefaultButtons()" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm">üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏õ‡∏∏‡πà‡∏° Default</button>
                                    </div>
                                    <div class="text-xs text-gray-600">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‚òï ‡∏Å‡∏≤‡πÅ‡∏ü</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Today's Summary -->
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium text-gray-800 mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                            <div id="todaySummary" class="text-sm text-gray-600">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Income Tab -->
            <div id="incomeTabContent" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    üí∞ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°
                </h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Add Income Form -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <div class="flex gap-2 mb-2">
                                    <button type="button" onclick="setIncomeAmount(500)" class="px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded text-sm transition duration-200">500</button>
                                    <button type="button" onclick="setIncomeAmount(1000)" class="px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded text-sm transition duration-200">1000</button>
                                    <button type="button" onclick="setIncomeAmount(2000)" class="px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded text-sm transition duration-200">2000</button>
                                    <button type="button" onclick="setIncomeAmount(5000)" class="px-3 py-2 bg-green-100 hover:bg-green-200 text-green-700 rounded text-sm transition duration-200">5000</button>
                                </div>
                                <input type="number" id="incomeAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 text-sm" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏≠‡∏á">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</label>
                                <div class="grid grid-cols-2 gap-2" id="incomeTypeButtons">
                                    <button type="button" onclick="selectIncomeType('freelance')" class="income-type-btn p-2 border-2 border-green-500 bg-green-50 text-green-800 rounded-lg text-sm transition duration-200" data-type="freelance">
                                        üíº ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå
                                    </button>
                                    <button type="button" onclick="selectIncomeType('commission')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="commission">
                                        üí∞ ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô
                                    </button>
                                    <button type="button" onclick="selectIncomeType('parttime')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="parttime">
                                        ‚è∞ ‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå
                                    </button>
                                    <button type="button" onclick="selectIncomeType('bonus')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="bonus">
                                        üéÅ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™
                                    </button>
                                    <button type="button" onclick="selectIncomeType('investment')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="investment">
                                        üìà ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô
                                    </button>
                                    <button type="button" onclick="selectIncomeType('selling')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="selling">
                                        üõí ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á
                                    </button>
                                    <button type="button" onclick="selectIncomeType('gift')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="gift">
                                        üéâ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç
                                    </button>
                                    <button type="button" onclick="selectIncomeType('others')" class="income-type-btn p-2 border-2 border-gray-300 rounded-lg text-sm hover:border-green-500 transition duration-200" data-type="others">
                                        üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                    </button>
                                </div>
                                <input type="hidden" id="selectedIncomeType" value="freelance">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                                <input type="text" id="incomeNote" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤, ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô">
                            </div>
                            <button onclick="addIncome()" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°
                            </button>
                        </div>
                    </div>

                    <!-- Income Summary -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</h3>
                        
                        <!-- This Month Summary -->
                        <div class="p-4 bg-green-50 rounded-lg mb-4">
                            <h4 class="font-medium text-green-800 mb-2">üìä ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h4>
                            <div id="monthlyIncomeSummary" class="text-sm text-green-600">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°
                            </div>
                        </div>
                        
                        <!-- Quick Income Buttons -->
                        <div class="mb-4">
                            <h4 class="font-medium text-gray-800 mb-2">‚ö° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô</h4>
                            <div class="grid grid-cols-2 gap-2" id="quickIncomeButtons">
                                <button onclick="quickAddIncome('commission', 1000, '‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô')" class="p-2 bg-green-100 hover:bg-green-200 text-green-800 rounded text-sm">üí∞ ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô<br><span class="text-xs">1,000 ‡∏ö‡∏≤‡∏ó</span></button>
                                <button onclick="quickAddIncome('freelance', 2000, '‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå')" class="p-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded text-sm">üíº ‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå<br><span class="text-xs">2,000 ‡∏ö‡∏≤‡∏ó</span></button>
                                <button onclick="quickAddIncome('selling', 500, '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå')" class="p-2 bg-purple-100 hover:bg-purple-200 text-purple-800 rounded text-sm">üõí ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á<br><span class="text-xs">500 ‡∏ö‡∏≤‡∏ó</span></button>
                                <button onclick="quickAddIncome('parttime', 1500, '‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå')" class="p-2 bg-orange-100 hover:bg-orange-200 text-orange-800 rounded text-sm">‚è∞ ‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå<br><span class="text-xs">1,500 ‡∏ö‡∏≤‡∏ó</span></button>
                            </div>
                        </div>
                        
                        <!-- Recent Income -->
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium text-gray-800 mb-2">üìã ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                            <div id="recentIncomeList" class="text-sm text-gray-600 max-h-32 overflow-y-auto">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expense History -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <div class="flex gap-2">
                    <button onclick="showExpenseHistory('today')" id="todayBtn" class="px-3 py-1 bg-blue-600 text-white rounded text-sm">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button onclick="showExpenseHistory('week')" id="weekBtn" class="px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
                    <button onclick="showExpenseHistory('month')" id="monthBtn" class="px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button onclick="clearAllExpenses()" class="px-3 py-1 bg-red-500 text-white rounded text-sm">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
            <div id="expenseHistory" class="space-y-2 max-h-60 overflow-y-auto">
                <div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Income Input -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    üíµ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="salary" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="30000" oninput="calculateFinances()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="extraIncome" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" oninput="calculateFinances()">
                    </div>
                </div>
            </div>

            <!-- Expenses Input -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    üí∏ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-medium text-gray-700">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                        <input type="number" id="food" class="w-28 px-3 py-2 border border-gray-300 rounded text-right" placeholder="8000" oninput="calculateFinances()">
                    </div>
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-medium text-gray-700">‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
                        <input type="number" id="transport" class="w-28 px-3 py-2 border border-gray-300 rounded text-right" placeholder="3000" oninput="calculateFinances()">
                    </div>
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-medium text-gray-700">‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</label>
                        <input type="number" id="housing" class="w-28 px-3 py-2 border border-gray-300 rounded text-right" placeholder="8000" oninput="calculateFinances()">
                    </div>
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-medium text-gray-700">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                        <input type="number" id="others" class="w-28 px-3 py-2 border border-gray-300 rounded text-right" placeholder="5000" oninput="calculateFinances()">
                    </div>
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-medium text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</label>
                        <input type="number" id="entertainment" class="w-28 px-3 py-2 border border-gray-300 rounded text-right" placeholder="4000" oninput="calculateFinances()">
                    </div>
                </div>
                <button onclick="resetToRecommended()" class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm">
                    ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                </button>
            </div>

            <!-- Summary -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
                </h2>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                        <span class="text-green-700 font-medium">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</span>
                        <span id="totalIncome" class="text-green-700 font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                        <span class="text-red-700 font-medium">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</span>
                        <span id="totalExpenses" class="text-red-700 font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                        <span class="text-blue-700 font-medium">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
                        <span id="remaining" class="text-blue-700 font-bold">0 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                        <div class="text-yellow-700 font-medium mb-2">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</div>
                        <div id="savingPercentage" class="text-2xl font-bold text-yellow-700">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts and Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Expense Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìà ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <div class="w-full h-80 flex items-center justify-center">
                    <canvas id="expenseChart" style="max-width: 350px; max-height: 350px;"></canvas>
                </div>
            </div>

            <!-- Savings Plan -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üéØ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h3>
                <div id="savingsAnalysis" class="space-y-4">
                    <div class="text-center text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</div>
                </div>
            </div>
        </div>

        <!-- Quick Savings Calculator -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">‚è∞ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πà‡∏ß‡∏ô</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="quickCalcTarget" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="50000" oninput="quickCalculateTime()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="quickCalcMonthly" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="5000" oninput="quickCalculateTime()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="quickCalcCurrent" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="0" oninput="quickCalculateTime()">
                </div>
            </div>
            <div id="quickCalcResult" class="mt-4 p-4 bg-blue-50 rounded-lg text-center">
                <div class="text-blue-700">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤</div>
            </div>
        </div>

        <!-- Savings Goals -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">üèÜ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h3>
                <button onclick="addNewGoal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
                </button>
            </div>
            <div id="goalsContainer" class="space-y-4">
                <!-- Goals will be rendered here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let expenseChart = null;
        let dailyExpenses = [];
        let customQuickButtons = [];
        let selectedCategory = 'food';
        let savingsGoals = [];
        let extraIncomes = [];
        let selectedIncomeType = 'freelance';
        let currentTab = 'expense';
        
        // Google Apps Script Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzPJTtfkONZjvNU8KKuOZi6V6TG8v0xWuTCfp86r22xq3WcdfJxi7Nh3eMx1K2OQ2I5/exec';
        const GOOGLE_SHEET_ID = '1Lj18zZfSLQvVhgdmUGZvTbAZd92eFunJchdomy2Uk_U';
        let isOnlineMode = false; // ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Google Script ‡∏ú‡πà‡∏≤‡∏ô JSONP (‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS)
		async function callGoogleScript(action, data = {}) {
		if (!GOOGLE_SCRIPT_URL) {
		console.log('Google Script URL not configured, using localStorage');
		return null;
		}
		try {
		return await callGoogleScriptJSONP(action, data);
		} catch (err) {
		console.error('Google Script API Error:', err);
		showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö offline', 'warning');
		return null;
		}
		}

        // Alternative JSONP-style method for Google Apps Script
		function callGoogleScriptJSONP(action, data = {}) {
		return new Promise((resolve, reject) => {
		const callbackName = 'googleCallback_' + Date.now();
		window[callbackName] = res => {
		// clean up
		delete window[callbackName];
		document.head.removeChild(script);
		resolve(res);
		};

		const script = document.createElement('script');
		const params = new URLSearchParams({
		action: action,
		data: JSON.stringify(data),
		callback: callbackName,
		sheetId: GOOGLE_SHEET_ID
		});
		script.src = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
	
		script.onerror = e => {
		delete window[callbackName];
		document.head.removeChild(script);
		reject(e);
		};

		document.head.appendChild(script);
		});
		}

        // Update connection status display
        function updateConnectionStatus(isOnline, message) {
            const statusDiv = document.getElementById('connectionStatus');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            
            if (isOnline) {
                statusDiv.className = 'mt-4 p-3 rounded-lg text-sm bg-green-50 border border-green-200';
                statusIcon.className = 'w-3 h-3 rounded-full bg-green-500';
                statusText.textContent = 'üåê ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÅ‡∏•‡πâ‡∏ß - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞ sync ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥';
            } else {
                statusDiv.className = 'mt-4 p-3 rounded-lg text-sm bg-blue-50 border border-blue-200';
                statusIcon.className = 'w-3 h-3 rounded-full bg-blue-500';
                statusText.textContent = 'üíæ ‡πÇ‡∏´‡∏°‡∏î Offline - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á';
            }
        }

        // Test connection to Google Sheets
        async function testConnection() {
            console.log('Testing connection to Google Sheets...');
            
            try {
                const result = await callGoogleScript('test', { timestamp: Date.now() });
                console.log('Connection test result:', result);
                
                if (result && result.success) {
                    isOnlineMode = true;
                    updateConnectionStatus(true);
                    showMessage('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
                    await loadDataFromSheets();
                } else {
                    throw new Error('Connection test failed');
                }
            } catch (error) {
                console.error('Connection test error:', error);
                isOnlineMode = false;
                updateConnectionStatus(false);
                showMessage('‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö offline - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', 'info');
            }
        }

        // Load data from Google Sheets
        async function loadDataFromSheets() {
            if (!isOnlineMode) return;
            
            try {
                // Load expenses
                const expensesResult = await callGoogleScript('getExpenses');
                if (expensesResult && expensesResult.success) {
                    dailyExpenses = expensesResult.data || [];
                }
                
                // Load incomes
                const incomesResult = await callGoogleScript('getIncomes');
                if (incomesResult && incomesResult.success) {
                    extraIncomes = incomesResult.data || [];
                }
                
                // Load goals
                const goalsResult = await callGoogleScript('getGoals');
                if (goalsResult && goalsResult.success) {
                    savingsGoals = goalsResult.data || [];
                }
                
                // Load settings
                const settingsResult = await callGoogleScript('getSettings');
                if (settingsResult && settingsResult.success && settingsResult.data) {
                    const settings = settingsResult.data;
                    if (settings.salary) document.getElementById('salary').value = settings.salary;
                    if (settings.extraIncome) document.getElementById('extraIncome').value = settings.extraIncome;
                    if (settings.food) document.getElementById('food').value = settings.food;
                    if (settings.transport) document.getElementById('transport').value = settings.transport;
                    if (settings.housing) document.getElementById('housing').value = settings.housing;
                    if (settings.others) document.getElementById('others').value = settings.others;
                    if (settings.entertainment) document.getElementById('entertainment').value = settings.entertainment;
                }
                
                updateDisplay();
                updateIncomeDisplay();
                renderGoals();
                calculateFinances();
                
            } catch (error) {
                console.error('Error loading data from sheets:', error);
            }
        }

        // Save data to Google Sheets
        async function saveDataToSheets() {
            if (!isOnlineMode) return;
            
            try {
                // Save settings
                const settings = {
                    salary: document.getElementById('salary').value,
                    extraIncome: document.getElementById('extraIncome').value,
                    food: document.getElementById('food').value,
                    transport: document.getElementById('transport').value,
                    housing: document.getElementById('housing').value,
                    others: document.getElementById('others').value,
                    entertainment: document.getElementById('entertainment').value
                };
                
                await callGoogleScript('saveSettings', settings);
                await callGoogleScript('saveExpenses', dailyExpenses);
                await callGoogleScript('saveIncomes', extraIncomes);
                await callGoogleScript('saveGoals', savingsGoals);
                
            } catch (error) {
                console.error('Error saving data to sheets:', error);
            }
        }

        // Custom message system to replace alert/confirm
        function showMessage(message, type = 'info') {
            // Remove existing message if any
            const existingMessage = document.getElementById('customMessage');
            if (existingMessage) {
                existingMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.id = 'customMessage';
            messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white',
                warning: 'bg-yellow-500 text-white'
            };
            
            messageDiv.className += ` ${colors[type] || colors.info}`;
            messageDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">√ó</button>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Animate in
            setTimeout(() => {
                messageDiv.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.classList.add('translate-x-full');
                    setTimeout(() => messageDiv.remove(), 300);
                }
            }, 3000);
        }

        // Custom confirmation dialog
        function showConfirmDialog(title, message, onConfirm) {
            // Remove existing dialog if any
            const existingDialog = document.getElementById('customDialog');
            if (existingDialog) {
                existingDialog.remove();
            }

            const dialogDiv = document.createElement('div');
            dialogDiv.id = 'customDialog';
            dialogDiv.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            
            // Create confirm button handler
            const confirmHandler = () => {
                document.getElementById('customDialog').remove();
                onConfirm();
            };
            
            dialogDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${title}</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <div class="flex gap-3 justify-end">
                        <button onclick="document.getElementById('customDialog').remove()" 
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition duration-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button id="confirmBtn" 
                                class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition duration-200">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialogDiv);
            
            // Add event listener to confirm button
            document.getElementById('confirmBtn').addEventListener('click', confirmHandler);
        }

        // Default quick buttons
        const defaultQuickButtons = [
            { id: 'btn1', name: 'üç≥ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤', amount: 50, category: 'food' },
            { id: 'btn2', name: 'üçõ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô', amount: 80, category: 'food' },
            { id: 'btn3', name: 'üçú ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô', amount: 60, category: 'food' },
            { id: 'btn4', name: 'üöå ‡∏£‡∏ñ‡πÄ‡∏°‡∏•‡πå', amount: 30, category: 'transport' },
            { id: 'btn5', name: 'üöï ‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà', amount: 100, category: 'transport' },
            { id: 'btn6', name: 'üé¨ ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á', amount: 150, category: 'entertainment' }
        ];

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.getElementById('expenseTab').className = tab === 'expense' 
                ? 'px-4 py-2 bg-blue-600 text-white rounded-lg text-sm transition duration-200'
                : 'px-4 py-2 text-gray-600 rounded-lg text-sm transition duration-200 hover:bg-gray-200';
            
            document.getElementById('incomeTab').className = tab === 'income' 
                ? 'px-4 py-2 bg-green-600 text-white rounded-lg text-sm transition duration-200'
                : 'px-4 py-2 text-gray-600 rounded-lg text-sm transition duration-200 hover:bg-gray-200';
            
            // Show/hide content
            document.getElementById('expenseTabContent').classList.toggle('hidden', tab !== 'expense');
            document.getElementById('incomeTabContent').classList.toggle('hidden', tab !== 'income');
            
            if (tab === 'income') {
                updateIncomeDisplay();
            }
        }

        // Load data from localStorage
        function loadData() {
            const savedExpenses = localStorage.getItem('dailyExpenses');
            if (savedExpenses) {
                dailyExpenses = JSON.parse(savedExpenses);
            }
            
            const savedButtons = localStorage.getItem('customQuickButtons');
            if (savedButtons) {
                customQuickButtons = JSON.parse(savedButtons);
            }
            
            const savedIncomes = localStorage.getItem('extraIncomes');
            if (savedIncomes) {
                extraIncomes = JSON.parse(savedIncomes);
            }
            
            const savedGoals = localStorage.getItem('savingsGoals');
            if (savedGoals) {
                savingsGoals = JSON.parse(savedGoals);
            } else {
                // Simple default goals
                savingsGoals = [
                    { id: 'goal1', name: '‡∏ã‡∏∑‡πâ‡∏≠‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà', emoji: 'üì±', target: 30000, current: 0, monthlyContribution: 0 },
                    { id: 'goal2', name: '‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏∞‡πÄ‡∏•', emoji: 'üèñÔ∏è', target: 15000, current: 0, monthlyContribution: 0 }
                ];
            }
        }

        // Save data to localStorage and Google Sheets
        function saveData() {
            // Always save to localStorage as backup
            localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses));
            localStorage.setItem('customQuickButtons', JSON.stringify(customQuickButtons));
            localStorage.setItem('savingsGoals', JSON.stringify(savingsGoals));
            localStorage.setItem('extraIncomes', JSON.stringify(extraIncomes));
            
            // Also save to Google Sheets if online
            if (isOnlineMode) {
                saveDataToSheets();
            }
        }

        // Set income amount
        function setIncomeAmount(amount) {
            document.getElementById('incomeAmount').value = amount;
        }

        // Select income type
        function selectIncomeType(type) {
            selectedIncomeType = type;
            document.getElementById('selectedIncomeType').value = type;
            
            // Update button styles
            document.querySelectorAll('.income-type-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-50', 'text-green-800');
                btn.classList.add('border-gray-300');
            });
            
            const selectedBtn = document.querySelector(`[data-type="${type}"]`);
            if (selectedBtn) {
                selectedBtn.classList.remove('border-gray-300');
                selectedBtn.classList.add('border-green-500', 'bg-green-50', 'text-green-800');
            }
        }

        // Add income
        async function addIncome() {
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const note = document.getElementById('incomeNote').value.trim();
            
            if (!amount || amount <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            const income = {
                id: Date.now(),
                amount: amount,
                type: selectedIncomeType,
                note: note || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                date: new Date().toISOString(),
                dateString: new Date().toLocaleDateString('th-TH')
            };
            
            extraIncomes.unshift(income);
            
            // Save to localStorage first
            localStorage.setItem('extraIncomes', JSON.stringify(extraIncomes));
            
            // Try to sync to Google Sheets
            if (isOnlineMode) {
                try {
                    const result = await callGoogleScript('addIncome', income);
                    if (result && result.success) {
                        console.log('Income synced to Google Sheets successfully');
                    } else {
                        console.error('Failed to sync income to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing income:', error);
                }
            }
            
            // Clear form
            document.getElementById('incomeAmount').value = '';
            document.getElementById('incomeNote').value = '';
            
            updateIncomeDisplay();
            updateExtraIncomeInMainForm();
            showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Quick add income
        async function quickAddIncome(type, amount, note) {
            const income = {
                id: Date.now(),
                amount: amount,
                type: type,
                note: note,
                date: new Date().toISOString(),
                dateString: new Date().toLocaleDateString('th-TH')
            };
            
            extraIncomes.unshift(income);
            
            // Save to localStorage first
            localStorage.setItem('extraIncomes', JSON.stringify(extraIncomes));
            
            // Try to sync to Google Sheets
            if (isOnlineMode) {
                try {
                    const result = await callGoogleScript('addIncome', income);
                    if (result && result.success) {
                        console.log('Quick income synced to Google Sheets successfully');
                    } else {
                        console.error('Failed to sync quick income to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing quick income:', error);
                }
            }
            
            updateIncomeDisplay();
            updateExtraIncomeInMainForm();
            showMessage(`‡πÄ‡∏û‡∏¥‡πà‡∏°${note} ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
        }

        // Update income display
        function updateIncomeDisplay() {
            updateMonthlyIncomeSummary();
            updateRecentIncomeList();
        }

        // Update monthly income summary
        function updateMonthlyIncomeSummary() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlyIncomes = extraIncomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const summaryDiv = document.getElementById('monthlyIncomeSummary');
            
            if (monthlyIncomes.length === 0) {
                summaryDiv.innerHTML = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°';
                return;
            }
            
            const total = monthlyIncomes.reduce((sum, income) => sum + income.amount, 0);
            const typeTotals = {};
            
            monthlyIncomes.forEach(income => {
                typeTotals[income.type] = (typeTotals[income.type] || 0) + income.amount;
            });
            
            const typeNames = {
                freelance: 'üíº ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå',
                commission: 'üí∞ ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô',
                parttime: '‚è∞ ‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå',
                bonus: 'üéÅ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™',
                investment: 'üìà ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô',
                selling: 'üõí ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á',
                gift: 'üéâ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç',
                others: 'üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            let summaryHTML = `<div class="font-bold text-green-800 mb-2">‡∏£‡∏ß‡∏°: ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>`;
            
            Object.entries(typeTotals).forEach(([type, amount]) => {
                summaryHTML += `<div class="flex justify-between text-sm">
                    <span>${typeNames[type]}</span>
                    <span>${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                </div>`;
            });
            
            summaryDiv.innerHTML = summaryHTML;
        }

        // Update recent income list
        function updateRecentIncomeList() {
            const recentDiv = document.getElementById('recentIncomeList');
            
            if (extraIncomes.length === 0) {
                recentDiv.innerHTML = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°';
                return;
            }
            
            const typeNames = {
                freelance: 'üíº ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏ô‡∏ã‡πå',
                commission: 'üí∞ ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô',
                parttime: '‚è∞ ‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå',
                bonus: 'üéÅ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™',
                investment: 'üìà ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô',
                selling: 'üõí ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á',
                gift: 'üéâ ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç',
                others: 'üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            let recentHTML = '';
            const recentIncomes = extraIncomes.slice(0, 5); // Show last 5
            
            recentIncomes.forEach(income => {
                const time = new Date(income.date).toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                recentHTML += `
                    <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="text-xs">${typeNames[income.type]}</span>
                                <span class="text-xs text-gray-500">${time}</span>
                            </div>
                            <div class="text-xs text-gray-600">${income.note}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-700 text-sm">+${income.amount.toLocaleString()}</div>
                            <button onclick="deleteIncome('${income.id}')" class="text-red-500 hover:text-red-700 text-xs">‡∏•‡∏ö</button>
                        </div>
                    </div>
                `;
            });
            
            recentDiv.innerHTML = recentHTML;
        }

        // Delete income
        function deleteIncome(incomeId) {
            extraIncomes = extraIncomes.filter(income => income.id.toString() !== incomeId.toString());
            saveData();
            updateIncomeDisplay();
            updateExtraIncomeInMainForm();
            showMessage('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Update extra income in main form
        function updateExtraIncomeInMainForm() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlyIncomes = extraIncomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getMonth() === currentMonth && incomeDate.getFullYear() === currentYear;
            });
            
            const total = monthlyIncomes.reduce((sum, income) => sum + income.amount, 0);
            document.getElementById('extraIncome').value = total;
            calculateFinances();
        }

        // Set amount in input field
        function setAmount(amount) {
            document.getElementById('expenseAmount').value = amount;
        }

        // Select category
        function selectCategory(category) {
            selectedCategory = category;
            document.getElementById('selectedCategory').value = category;
            
            // Update button styles
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50', 'text-blue-800');
                btn.classList.add('border-gray-300');
            });
            
            const selectedBtn = document.querySelector(`[data-category="${category}"]`);
            if (selectedBtn) {
                selectedBtn.classList.remove('border-gray-300');
                selectedBtn.classList.add('border-blue-500', 'bg-blue-50', 'text-blue-800');
            }
        }

        // Add expense
        async function addExpense() {
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const note = document.getElementById('expenseNote').value.trim();
            
            if (!amount || amount <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            const expense = {
                id: Date.now(),
                amount: amount,
                category: selectedCategory,
                note: note || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                date: new Date().toISOString(),
                dateString: new Date().toLocaleDateString('th-TH')
            };
            
            dailyExpenses.unshift(expense);
            
            // Save to localStorage first
            localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses));
            
            // Try to sync to Google Sheets
            if (isOnlineMode) {
                try {
                    const result = await callGoogleScript('addExpense', expense);
                    if (result && result.success) {
                        console.log('Expense synced to Google Sheets successfully');
                    } else {
                        console.error('Failed to sync expense to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing expense:', error);
                }
            }
            
            // Clear form
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseNote').value = '';
            
            updateDisplay();
            showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Quick add expense
        async function quickAddExpense(category, amount, note) {
            const expense = {
                id: Date.now(),
                amount: amount,
                category: category,
                note: note,
                date: new Date().toISOString(),
                dateString: new Date().toLocaleDateString('th-TH')
            };
            
            dailyExpenses.unshift(expense);
            
            // Save to localStorage first
            localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses));
            
            // Try to sync to Google Sheets
            if (isOnlineMode) {
                try {
                    const result = await callGoogleScript('addExpense', expense);
                    if (result && result.success) {
                        console.log('Quick expense synced to Google Sheets successfully');
                    } else {
                        console.error('Failed to sync quick expense to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing quick expense:', error);
                }
            }
            
            updateDisplay();
            showMessage(`‡πÄ‡∏û‡∏¥‡πà‡∏°${note} ${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
        }

        // Toggle quick buttons editor
        function toggleQuickButtonsEditor() {
            const editor = document.getElementById('quickButtonsEditor');
            editor.classList.toggle('hidden');
        }

        // Add custom quick button
        function addCustomQuickButton() {
            const name = document.getElementById('newButtonName').value.trim();
            const amount = parseFloat(document.getElementById('newButtonAmount').value);
            const category = document.getElementById('newButtonCategory').value;

            if (!name || !amount || amount <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const newButton = {
                id: 'custom_' + Date.now(),
                name: name,
                amount: amount,
                category: category
            };

            customQuickButtons.push(newButton);
            saveData();

            // Clear form
            document.getElementById('newButtonName').value = '';
            document.getElementById('newButtonAmount').value = '';

            renderQuickButtons();
            showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Remove quick button
        function removeQuickButton(buttonId) {
            if (buttonId.startsWith('custom_')) {
                // Remove custom button
                customQuickButtons = customQuickButtons.filter(btn => btn.id !== buttonId);
            } else {
                // Hide default button by adding to hidden list
                let hiddenButtons = JSON.parse(localStorage.getItem('hiddenDefaultButtons') || '[]');
                if (!hiddenButtons.includes(buttonId)) {
                    hiddenButtons.push(buttonId);
                    localStorage.setItem('hiddenDefaultButtons', JSON.stringify(hiddenButtons));
                }
            }
            saveData();
            renderQuickButtons();
        }

        // Edit quick button
        function editQuickButton(buttonId) {
            let button;
            if (buttonId.startsWith('custom_')) {
                button = customQuickButtons.find(btn => btn.id === buttonId);
            } else {
                button = defaultQuickButtons.find(btn => btn.id === buttonId);
            }
            
            if (!button) return;
            
            // Show edit dialog
            const dialogDiv = document.createElement('div');
            dialogDiv.id = 'editButtonDialog';
            dialogDiv.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            dialogDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°</label>
                            <input type="text" id="editButtonName" value="${button.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="editButtonAmount" value="${button.amount}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="editButtonCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="food" ${button.category === 'food' ? 'selected' : ''}>üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                                <option value="transport" ${button.category === 'transport' ? 'selected' : ''}>üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
                                <option value="housing" ${button.category === 'housing' ? 'selected' : ''}>üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</option>
                                <option value="entertainment" ${button.category === 'entertainment' ? 'selected' : ''}>üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á</option>
                                <option value="bills" ${button.category === 'bills' ? 'selected' : ''}>üìÑ ‡∏ö‡∏¥‡∏•/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</option>
                                <option value="shopping" ${button.category === 'shopping' ? 'selected' : ''}>üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</option>
                                <option value="savings" ${button.category === 'savings' ? 'selected' : ''}>üí∞ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô</option>
                                <option value="others" ${button.category === 'others' ? 'selected' : ''}>üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="document.getElementById('editButtonDialog').remove()" 
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition duration-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="saveEditedButton('${buttonId}')" 
                                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition duration-200">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialogDiv);
        }

        // Save edited button
        function saveEditedButton(buttonId) {
            const name = document.getElementById('editButtonName').value.trim();
            const amount = parseFloat(document.getElementById('editButtonAmount').value);
            const category = document.getElementById('editButtonCategory').value;

            if (!name || !amount || amount <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            if (buttonId.startsWith('custom_')) {
                // Edit custom button
                const buttonIndex = customQuickButtons.findIndex(btn => btn.id === buttonId);
                if (buttonIndex !== -1) {
                    customQuickButtons[buttonIndex] = {
                        ...customQuickButtons[buttonIndex],
                        name: name,
                        amount: amount,
                        category: category
                    };
                }
            } else {
                // Convert default button to custom button
                const newCustomButton = {
                    id: 'custom_' + Date.now(),
                    name: name,
                    amount: amount,
                    category: category
                };
                customQuickButtons.push(newCustomButton);
                
                // Hide the original default button
                let hiddenButtons = JSON.parse(localStorage.getItem('hiddenDefaultButtons') || '[]');
                if (!hiddenButtons.includes(buttonId)) {
                    hiddenButtons.push(buttonId);
                    localStorage.setItem('hiddenDefaultButtons', JSON.stringify(hiddenButtons));
                }
            }

            saveData();
            renderQuickButtons();
            document.getElementById('editButtonDialog').remove();
            showMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Reset to default buttons
        function resetToDefaultButtons() {
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô
            localStorage.removeItem('hiddenDefaultButtons');
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
            customQuickButtons = [];
            localStorage.removeItem('customQuickButtons');
            renderQuickButtons();
        }

        // Render quick buttons
        function renderQuickButtons() {
            const container = document.getElementById('quickButtonsContainer');
            const hiddenButtons = JSON.parse(localStorage.getItem('hiddenDefaultButtons') || '[]');
            const visibleDefaultButtons = defaultQuickButtons.filter(btn => !hiddenButtons.includes(btn.id));
            const allButtons = [...visibleDefaultButtons, ...customQuickButtons];
            
            let buttonsHTML = '';
            allButtons.forEach(btn => {
                const colorClass = btn.category === 'food' ? 'bg-green-100 hover:bg-green-200 text-green-800' :
                                 btn.category === 'transport' ? 'bg-blue-100 hover:bg-blue-200 text-blue-800' :
                                 btn.category === 'housing' ? 'bg-purple-100 hover:bg-purple-200 text-purple-800' :
                                 btn.category === 'entertainment' ? 'bg-pink-100 hover:bg-pink-200 text-pink-800' :
                                 btn.category === 'bills' ? 'bg-orange-100 hover:bg-orange-200 text-orange-800' :
                                 btn.category === 'shopping' ? 'bg-red-100 hover:bg-red-200 text-red-800' :
                                 btn.category === 'savings' ? 'bg-yellow-100 hover:bg-yellow-200 text-yellow-800' :
                                 'bg-gray-100 hover:bg-gray-200 text-gray-800';
                
                buttonsHTML += `
                    <div class="relative group">
                        <button onclick="quickAddExpense('${btn.category}', ${btn.amount}, '${btn.name}')" 
                                class="w-full p-3 ${colorClass} rounded-lg text-sm transition duration-200">
                            ${btn.name}<br><span class="text-xs">${btn.amount} ‡∏ö‡∏≤‡∏ó</span>
                        </button>
                        <div class="absolute -top-1 -right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <button onclick="event.stopPropagation(); editQuickButton('${btn.id}')" 
                                    class="bg-blue-500 text-white rounded-full w-6 h-6 text-xs hover:bg-blue-600 transition duration-200 z-10 flex items-center justify-center">‚úèÔ∏è</button>
                            <button onclick="event.stopPropagation(); removeQuickButton('${btn.id}')" 
                                    class="bg-red-500 text-white rounded-full w-6 h-6 text-xs hover:bg-red-600 transition duration-200 z-10 flex items-center justify-center">√ó</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = buttonsHTML;
        }

        // Update today's summary
        function updateTodaySummary() {
            const today = new Date().toLocaleDateString('th-TH');
            const todayExpenses = dailyExpenses.filter(exp => exp.dateString === today);
            
            if (todayExpenses.length === 0) {
                document.getElementById('todaySummary').innerHTML = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
                return;
            }
            
            const total = todayExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const categoryTotals = {};
            
            todayExpenses.forEach(exp => {
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
            });
            
            const categoryNames = {
                food: 'üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                transport: 'üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',
                housing: 'üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å',
                entertainment: 'üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á',
                bills: 'üìÑ ‡∏ö‡∏¥‡∏•/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢',
                shopping: 'üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á',
                savings: 'üí∞ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô',
                others: 'üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            let summaryHTML = `<div class="font-bold text-gray-800 mb-2">‡∏£‡∏ß‡∏°: ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>`;
            
            Object.entries(categoryTotals).forEach(([category, amount]) => {
                summaryHTML += `<div class="flex justify-between text-sm">
                    <span>${categoryNames[category]}</span>
                    <span>${amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                </div>`;
            });
            
            document.getElementById('todaySummary').innerHTML = summaryHTML;
        }

        // Show expense history
        function showExpenseHistory(period) {
            // Update button styles
            document.querySelectorAll('#todayBtn, #weekBtn, #monthBtn').forEach(btn => {
                btn.className = 'px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm';
            });
            document.getElementById(period + 'Btn').className = 'px-3 py-1 bg-blue-600 text-white rounded text-sm';
            
            const now = new Date();
            let filteredExpenses = [];
            
            if (period === 'today') {
                const today = now.toLocaleDateString('th-TH');
                filteredExpenses = dailyExpenses.filter(exp => exp.dateString === today);
            } else if (period === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredExpenses = dailyExpenses.filter(exp => new Date(exp.date) >= weekAgo);
            } else if (period === 'month') {
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredExpenses = dailyExpenses.filter(exp => new Date(exp.date) >= monthAgo);
            }
            
            const historyDiv = document.getElementById('expenseHistory');
            
            if (filteredExpenses.length === 0) {
                historyDiv.innerHTML = '<div class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ</div>';
                return;
            }
            
            const categoryNames = {
                food: 'üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                transport: 'üöó ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',
                housing: 'üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å',
                entertainment: 'üéÆ ‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á',
                bills: 'üìÑ ‡∏ö‡∏¥‡∏•/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢',
                shopping: 'üõçÔ∏è ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á',
                savings: 'üí∞ ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô',
                others: 'üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            let historyHTML = '';
            filteredExpenses.forEach(exp => {
                const time = new Date(exp.date).toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                historyHTML += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-medium">${categoryNames[exp.category] || 'üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}</span>
                                <span class="text-sm text-gray-500">${time}</span>
                            </div>
                            <div class="text-sm text-gray-600">${exp.note}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">${exp.amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                            <button onclick="deleteExpense('${exp.id}')" class="text-red-500 hover:text-red-700 text-xs bg-red-50 hover:bg-red-100 px-2 py-1 rounded mt-1">‡∏•‡∏ö</button>
                        </div>
                    </div>
                `;
            });
            
            historyDiv.innerHTML = historyHTML;
        }

        // Delete expense
        async function deleteExpense(expenseId) {
            // Find the expense before deleting
            const expenseToDelete = dailyExpenses.find(exp => exp.id.toString() === expenseId.toString());
            
            dailyExpenses = dailyExpenses.filter(exp => exp.id.toString() !== expenseId.toString());
            
            // Save to localStorage first
            localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses));
            
            // Try to sync deletion to Google Sheets
            if (isOnlineMode && expenseToDelete) {
                try {
                    const result = await callGoogleScript('deleteExpense', { id: expenseId });
                    if (result && result.success) {
                        console.log('Expense deletion synced to Google Sheets successfully');
                    } else {
                        console.error('Failed to sync expense deletion to Google Sheets');
                    }
                } catch (error) {
                    console.error('Error syncing expense deletion:', error);
                }
            }
            
            updateDisplay();
            showMessage('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Clear all expenses
        function clearAllExpenses() {
            // Show confirmation dialog
            showConfirmDialog(
                '‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!',
                function() {
                    dailyExpenses = [];
                    saveData();
                    updateDisplay();
                    calculateFinances();
                    showMessage('‚úÖ ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                }
            );
        }

        // Auto calculate from quick setup
        function autoCalculate() {
            const quickSalary = parseFloat(document.getElementById('quickSalary').value) || 0;
            const quickExtra = parseFloat(document.getElementById('quickExtra').value) || 0;
            const totalIncome = quickSalary + quickExtra;

            if (totalIncome > 0) {
                document.getElementById('salary').value = quickSalary;
                document.getElementById('extraIncome').value = quickExtra;
                
                // Recommended expense ratios
                document.getElementById('food').value = Math.round(totalIncome * 0.25);
                document.getElementById('transport').value = Math.round(totalIncome * 0.10);
                document.getElementById('housing').value = Math.round(totalIncome * 0.30);
                document.getElementById('others').value = Math.round(totalIncome * 0.15);
                document.getElementById('entertainment').value = Math.round(totalIncome * 0.10);
                
                calculateFinances();
            }
        }

        // Reset to recommended values
        function resetToRecommended() {
            const salary = parseFloat(document.getElementById('salary').value) || 30000;
            const extraIncome = parseFloat(document.getElementById('extraIncome').value) || 0;
            const totalIncome = salary + extraIncome;

            document.getElementById('food').value = Math.round(totalIncome * 0.25);
            document.getElementById('transport').value = Math.round(totalIncome * 0.10);
            document.getElementById('housing').value = Math.round(totalIncome * 0.30);
            document.getElementById('others').value = Math.round(totalIncome * 0.15);
            document.getElementById('entertainment').value = Math.round(totalIncome * 0.10);
            
            calculateFinances();
        }

        // Calculate finances
        function calculateFinances() {
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const extraIncome = parseFloat(document.getElementById('extraIncome').value) || 0;
            const totalIncome = salary + extraIncome;

            const food = parseFloat(document.getElementById('food').value) || 0;
            const transport = parseFloat(document.getElementById('transport').value) || 0;
            const housing = parseFloat(document.getElementById('housing').value) || 0;
            const others = parseFloat(document.getElementById('others').value) || 0;
            const entertainment = parseFloat(document.getElementById('entertainment').value) || 0;
            const totalExpenses = food + transport + housing + others + entertainment;

            const remaining = totalIncome - totalExpenses;
            const savingPercentage = totalIncome > 0 ? ((remaining / totalIncome) * 100).toFixed(1) : 0;

            document.getElementById('totalIncome').textContent = totalIncome.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('totalExpenses').textContent = totalExpenses.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('remaining').textContent = remaining.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
            document.getElementById('savingPercentage').textContent = savingPercentage + '%';

            updateExpenseChart(food, transport, housing, others, entertainment);
            updateSavingsAnalysis(remaining, totalIncome, savingPercentage);
        }

        // Update expense chart
        function updateExpenseChart(food, transport, housing, others, entertainment) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            if (expenseChart) {
                expenseChart.destroy();
            }

            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', '‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å', '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á'],
                    datasets: [{
                        data: [food, transport, housing, others, entertainment],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 1,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update savings analysis
        function updateSavingsAnalysis(remaining, totalIncome, savingPercentage) {
            const analysisDiv = document.getElementById('savingsAnalysis');
            let analysis = '';

            if (remaining <= 0) {
                analysis = `
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <h4 class="font-medium text-red-800 mb-2">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ß‡∏¥‡∏Å‡∏§‡∏ï!</h4>
                        <p class="text-red-700 text-sm mb-3">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ${Math.abs(remaining).toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                        <div class="text-sm text-red-600">
                            <p>‚Ä¢ ‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                            <p>‚Ä¢ ‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°</p>
                            <p>‚Ä¢ ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</p>
                        </div>
                    </div>
                `;
            } else if (savingPercentage < 10) {
                analysis = `
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-medium text-yellow-800 mb-2">‚ö° ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</h4>
                        <p class="text-yellow-700 text-sm mb-3">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${savingPercentage}% ‡∏ã‡∏∂‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</p>
                        <div class="text-sm text-yellow-600">
                            <p>‚Ä¢ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ: ‡∏≠‡∏≠‡∏° 20% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</p>
                            <p>‚Ä¢ ‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢</p>
                            <p>‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î</p>
                        </div>
                    </div>
                `;
            } else if (savingPercentage < 20) {
                analysis = `
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">üëç ‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏î‡πâ</h4>
                        <p class="text-blue-700 text-sm mb-3">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏°‡πÑ‡∏î‡πâ ${savingPercentage}% ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 20% ‡πÅ‡∏•‡πâ‡∏ß</p>
                        <div class="text-sm text-blue-600">
                            <p>‚Ä¢ ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏≠‡∏µ‡∏Å ${(20 - parseFloat(savingPercentage)).toFixed(1)}%</p>
                            <p>‚Ä¢ ‡∏´‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô</p>
                            <p>‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß</p>
                        </div>
                    </div>
                `;
            } else {
                analysis = `
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-medium text-green-800 mb-2">üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h4>
                        <p class="text-green-700 text-sm mb-3">‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏°‡πÑ‡∏î‡πâ ${savingPercentage}% ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 20% ‡πÅ‡∏•‡πâ‡∏ß</p>
                        <div class="text-sm text-green-600">
                            <p>‚Ä¢ ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏°‡∏≤‡∏Å</p>
                            <p>‚Ä¢ ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô</p>
                            <p>‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô</p>
                        </div>
                    </div>
                `;
            }

            const monthlySavings = remaining;
            const yearlySavings = monthlySavings * 12;
            
            analysis += `
                <div class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                    <h4 class="font-medium text-gray-800 mb-2">üìÖ ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                            <div class="font-bold text-gray-800">${monthlySavings.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div>
                            <span class="text-gray-600">‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏µ:</span>
                            <div class="font-bold text-gray-800">${yearlySavings.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                </div>
            `;

            analysisDiv.innerHTML = analysis;
        }

        // Add new goal
        function addNewGoal() {
            const dialogDiv = document.createElement('div');
            dialogDiv.id = 'addGoalDialog';
            dialogDiv.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            dialogDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                            <input type="text" id="newGoalName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <div class="grid grid-cols-8 gap-1 mb-2 p-2 bg-gray-50 rounded-lg">
                                <button type="button" onclick="setGoalEmoji('üéØ')" class="p-2 hover:bg-gray-200 rounded text-lg">üéØ</button>
                                <button type="button" onclick="setGoalEmoji('üì±')" class="p-2 hover:bg-gray-200 rounded text-lg">üì±</button>
                                <button type="button" onclick="setGoalEmoji('üöó')" class="p-2 hover:bg-gray-200 rounded text-lg">üöó</button>
                                <button type="button" onclick="setGoalEmoji('üè†')" class="p-2 hover:bg-gray-200 rounded text-lg">üè†</button>
                                <button type="button" onclick="setGoalEmoji('‚úàÔ∏è')" class="p-2 hover:bg-gray-200 rounded text-lg">‚úàÔ∏è</button>
                                <button type="button" onclick="setGoalEmoji('üèñÔ∏è')" class="p-2 hover:bg-gray-200 rounded text-lg">üèñÔ∏è</button>
                                <button type="button" onclick="setGoalEmoji('üíç')" class="p-2 hover:bg-gray-200 rounded text-lg">üíç</button>
                                <button type="button" onclick="setGoalEmoji('üéì')" class="p-2 hover:bg-gray-200 rounded text-lg">üéì</button>
                                <button type="button" onclick="setGoalEmoji('üíª')" class="p-2 hover:bg-gray-200 rounded text-lg">üíª</button>
                                <button type="button" onclick="setGoalEmoji('üì∑')" class="p-2 hover:bg-gray-200 rounded text-lg">üì∑</button>
                                <button type="button" onclick="setGoalEmoji('üé∏')" class="p-2 hover:bg-gray-200 rounded text-lg">üé∏</button>
                                <button type="button" onclick="setGoalEmoji('üëó')" class="p-2 hover:bg-gray-200 rounded text-lg">üëó</button>
                                <button type="button" onclick="setGoalEmoji('üíÑ')" class="p-2 hover:bg-gray-200 rounded text-lg">üíÑ</button>
                                <button type="button" onclick="setGoalEmoji('‚åö')" class="p-2 hover:bg-gray-200 rounded text-lg">‚åö</button>
                                <button type="button" onclick="setGoalEmoji('üéÆ')" class="p-2 hover:bg-gray-200 rounded text-lg">üéÆ</button>
                                <button type="button" onclick="setGoalEmoji('üí∞')" class="p-2 hover:bg-gray-200 rounded text-lg">üí∞</button>
                            </div>
                            <input type="text" id="newGoalEmoji" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="üì±" maxlength="2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="newGoalTarget" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="30000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="newGoalCurrent" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="0">
                        </div>
                    </div>
                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="document.getElementById('addGoalDialog').remove()" 
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition duration-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="saveNewGoal()" 
                                class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition duration-200">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialogDiv);
        }

        // Save new goal
        function saveNewGoal() {
            const name = document.getElementById('newGoalName').value.trim();
            const emoji = document.getElementById('newGoalEmoji').value.trim() || 'üéØ';
            const target = parseFloat(document.getElementById('newGoalTarget').value);
            const current = parseFloat(document.getElementById('newGoalCurrent').value) || 0;

            if (!name || !target || target <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const newGoal = {
                id: 'goal_' + Date.now(),
                name: name,
                emoji: emoji,
                target: target,
                current: current,
                monthlyContribution: 0
            };

            savingsGoals.push(newGoal);
            saveData();
            renderGoals();
            document.getElementById('addGoalDialog').remove();
            showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Edit goal
        function editGoal(goalId) {
            const goal = savingsGoals.find(g => g.id === goalId);
            if (!goal) return;

            const dialogDiv = document.createElement('div');
            dialogDiv.id = 'editGoalDialog';
            dialogDiv.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            dialogDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                            <input type="text" id="editGoalName" value="${goal.name}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥</label>
                            <div class="grid grid-cols-8 gap-1 mb-2 p-2 bg-gray-50 rounded-lg">
                                <button type="button" onclick="setEditGoalEmoji('üéØ')" class="p-2 hover:bg-gray-200 rounded text-lg">üéØ</button>
                                <button type="button" onclick="setEditGoalEmoji('üì±')" class="p-2 hover:bg-gray-200 rounded text-lg">üì±</button>
                                <button type="button" onclick="setEditGoalEmoji('üöó')" class="p-2 hover:bg-gray-200 rounded text-lg">üöó</button>
                                <button type="button" onclick="setEditGoalEmoji('üè†')" class="p-2 hover:bg-gray-200 rounded text-lg">üè†</button>
                                <button type="button" onclick="setEditGoalEmoji('‚úàÔ∏è')" class="p-2 hover:bg-gray-200 rounded text-lg">‚úàÔ∏è</button>
                                <button type="button" onclick="setEditGoalEmoji('üèñÔ∏è')" class="p-2 hover:bg-gray-200 rounded text-lg">üèñÔ∏è</button>
                                <button type="button" onclick="setEditGoalEmoji('üíç')" class="p-2 hover:bg-gray-200 rounded text-lg">üíç</button>
                                <button type="button" onclick="setEditGoalEmoji('üéì')" class="p-2 hover:bg-gray-200 rounded text-lg">üéì</button>
                                <button type="button" onclick="setEditGoalEmoji('üíª')" class="p-2 hover:bg-gray-200 rounded text-lg">üíª</button>
                                <button type="button" onclick="setEditGoalEmoji('üì∑')" class="p-2 hover:bg-gray-200 rounded text-lg">üì∑</button>
                                <button type="button" onclick="setEditGoalEmoji('üé∏')" class="p-2 hover:bg-gray-200 rounded text-lg">üé∏</button>
                                <button type="button" onclick="setEditGoalEmoji('üëó')" class="p-2 hover:bg-gray-200 rounded text-lg">üëó</button>
                                <button type="button" onclick="setEditGoalEmoji('üíÑ')" class="p-2 hover:bg-gray-200 rounded text-lg">üíÑ</button>
                                <button type="button" onclick="setEditGoalEmoji('‚åö')" class="p-2 hover:bg-gray-200 rounded text-lg">‚åö</button>
                                <button type="button" onclick="setEditGoalEmoji('üéÆ')" class="p-2 hover:bg-gray-200 rounded text-lg">üéÆ</button>
                                <button type="button" onclick="setEditGoalEmoji('üí∞')" class="p-2 hover:bg-gray-200 rounded text-lg">üí∞</button>
                            </div>
                            <input type="text" id="editGoalEmoji" value="${goal.emoji}" class="w-full px-3 py-2 border border-gray-300 rounded-lg" maxlength="2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="editGoalTarget" value="${goal.target}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="editGoalCurrent" value="${goal.current}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="editGoalMonthly" value="${goal.monthlyContribution}" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="document.getElementById('editGoalDialog').remove()" 
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition duration-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="saveEditedGoal('${goalId}')" 
                                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition duration-200">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialogDiv);
        }

        // Save edited goal
        function saveEditedGoal(goalId) {
            const name = document.getElementById('editGoalName').value.trim();
            const emoji = document.getElementById('editGoalEmoji').value.trim();
            const target = parseFloat(document.getElementById('editGoalTarget').value);
            const current = parseFloat(document.getElementById('editGoalCurrent').value) || 0;
            const monthly = parseFloat(document.getElementById('editGoalMonthly').value) || 0;

            if (!name || !target || target <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const goalIndex = savingsGoals.findIndex(g => g.id === goalId);
            if (goalIndex !== -1) {
                savingsGoals[goalIndex] = {
                    ...savingsGoals[goalIndex],
                    name: name,
                    emoji: emoji,
                    target: target,
                    current: current,
                    monthlyContribution: monthly
                };
            }

            saveData();
            renderGoals();
            document.getElementById('editGoalDialog').remove();
            showMessage('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Delete goal
        function deleteGoal(goalId) {
            showConfirmDialog(
                '‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!',
                () => {
                    savingsGoals = savingsGoals.filter(g => g.id !== goalId);
                    saveData();
                    renderGoals();
                    showMessage('‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                }
            );
        }

        // Add money to goal
        function addMoneyToGoal(goalId) {
            const goal = savingsGoals.find(g => g.id === goalId);
            if (!goal) return;

            const dialogDiv = document.createElement('div');
            dialogDiv.id = 'addMoneyDialog';
            dialogDiv.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            dialogDiv.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üí∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h3>
                    <p class="text-gray-600 mb-4">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${goal.emoji} ${goal.name}</p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="addMoneyAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="1000">
                        </div>
                    </div>
                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="document.getElementById('addMoneyDialog').remove()" 
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg transition duration-200">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="saveAddedMoney('${goalId}')" 
                                class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition duration-200">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialogDiv);
        }

        // Save added money
        function saveAddedMoney(goalId) {
            const amount = parseFloat(document.getElementById('addMoneyAmount').value);
            
            if (!amount || amount <= 0) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            const goalIndex = savingsGoals.findIndex(g => g.id === goalId);
            if (goalIndex !== -1) {
                savingsGoals[goalIndex].current += amount;
                if (savingsGoals[goalIndex].current > savingsGoals[goalIndex].target) {
                    savingsGoals[goalIndex].current = savingsGoals[goalIndex].target;
                }
            }

            saveData();
            renderGoals();
            document.getElementById('addMoneyDialog').remove();
            showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }

        // Render goals
        function renderGoals() {
            const container = document.getElementById('goalsContainer');
            
            if (savingsGoals.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô<br>‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>';
                return;
            }

            let goalsHTML = '';
            savingsGoals.forEach(goal => {
                const progress = (goal.current / goal.target) * 100;
                const remaining = goal.target - goal.current;
                const monthsToComplete = goal.monthlyContribution > 0 ? Math.ceil(remaining / goal.monthlyContribution) : 0;
                
                goalsHTML += `
                    <div class="border border-gray-200 rounded-lg p-4 ${progress >= 100 ? 'bg-green-50 border-green-300' : ''}">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">${goal.emoji}</span>
                                <div>
                                    <h4 class="font-medium text-gray-800">${goal.name}</h4>
                                    <p class="text-sm text-gray-600">${goal.current.toLocaleString()} / ${goal.target.toLocaleString()} ‡∏ö‡∏≤‡∏ó</p>
                                </div>
                            </div>
                            <div class="flex gap-1">
                                <button onclick="addMoneyToGoal('${goal.id}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs">üí∞</button>
                                <button onclick="editGoal('${goal.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs">‚úèÔ∏è</button>
                                <button onclick="deleteGoal('${goal.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                            <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>${progress.toFixed(1)}% ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>
                            <span>‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${remaining.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        
                        ${goal.monthlyContribution > 0 ? `
                            <div class="text-sm text-blue-600">
                                üìÖ ‡∏≠‡∏≠‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ ${goal.monthlyContribution.toLocaleString()} ‡∏ö‡∏≤‡∏ó ‚Üí ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ô ${monthsToComplete} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            </div>
                        ` : ''}
                        
                        ${progress >= 100 ? `
                            <div class="mt-2 p-2 bg-green-100 rounded text-green-800 text-sm font-medium text-center">
                                üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = goalsHTML;
        }

        // Update all displays
        function updateDisplay() {
            updateTodaySummary();
            showExpenseHistory('today');
        }

        // Set emoji for new goal
        function setGoalEmoji(emoji) {
            document.getElementById('newGoalEmoji').value = emoji;
        }

        // Set emoji for editing goal
        function setEditGoalEmoji(emoji) {
            document.getElementById('editGoalEmoji').value = emoji;
        }

        // Add emoji to button name
        function addEmojiToButtonName(emoji) {
            const nameInput = document.getElementById('newButtonName');
            const currentValue = nameInput.value;
            nameInput.value = emoji + ' ' + currentValue.replace(/^[^\w\s]*\s*/, ''); // Remove existing emoji if any
            nameInput.focus();
        }

        // Quick calculate savings time
        function quickCalculateTime() {
            const target = parseFloat(document.getElementById('quickCalcTarget').value) || 0;
            const monthly = parseFloat(document.getElementById('quickCalcMonthly').value) || 0;
            const current = parseFloat(document.getElementById('quickCalcCurrent').value) || 0;
            
            const resultDiv = document.getElementById('quickCalcResult');
            
            if (target <= 0 || monthly <= 0) {
                resultDiv.innerHTML = '<div class="text-blue-700">üí° ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤</div>';
                return;
            }
            
            if (current >= target) {
                resultDiv.innerHTML = '<div class="text-green-700 font-bold">üéâ ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!</div>';
                return;
            }
            
            const remaining = target - current;
            const months = Math.ceil(remaining / monthly);
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            
            let timeText = '';
            if (years > 0) {
                timeText = `${years} ‡∏õ‡∏µ ${remainingMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            } else {
                timeText = `${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            }
            
            const totalSaved = monthly * months;
            const progress = (current / target) * 100;
            
            resultDiv.innerHTML = `
                <div class="space-y-2">
                    <div class="text-2xl font-bold text-blue-800">‚è∞ ${timeText}</div>
                    <div class="text-sm text-gray-600">
                        <div>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°‡∏≠‡∏µ‡∏Å: ${remaining.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        <div>üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${progress.toFixed(1)}%</div>
                        <div>üíµ ‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalSaved.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                    </div>
                    <div class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize app
        async function initApp() {
            // Load local data first
            loadData();
            renderQuickButtons();
            renderGoals();
            updateDisplay();
            updateIncomeDisplay();
            updateExtraIncomeInMainForm();
            
            // Set default values
            document.getElementById('salary').value = '30000';
            document.getElementById('food').value = '8000';
            document.getElementById('transport').value = '3000';
            document.getElementById('housing').value = '8000';
            document.getElementById('others').value = '5000';
            document.getElementById('entertainment').value = '4000';
            
            calculateFinances();
            
            // Test Google Sheets connection
            await testConnection();
        }

        // Start the app
          window.addEventListener('DOMContentLoaded', () => {
		initApp();
		});
		
	
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'961bb9da15d27322',t:'MTc1Mjk0MzkxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
